<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lane Ownership Pro - 3D GPS Tracking</title>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBEbLeeT2G2czmJ5JMTckUj6qZJ3oqXg7k&libraries=places"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%),
                        url('https://images.unsplash.com/photo-1588137488142-b52cc277f4f3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=85') center/cover fixed;
            min-height: 100vh;
            color: white;
        }
        .glass { 
            backdrop-filter: blur(25px); 
            background: rgba(255,255,255,0.08); 
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        .gradient-text {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        #map { height: 500px; border-radius: 20px; box-shadow: 0 25px 50px rgba(0,0,0,0.6); }
        .car-3d {
            width: 60px !important;
            height: 60px !important;
            background: linear-gradient(45deg, #10b981, #34d399);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            box-shadow: 
                0 10px 30px rgba(16,185,129,0.6),
                inset 0 2px 0 rgba(255,255,255,0.3),
                inset 0 -2px 10px rgba(0,0,0,0.3);
            border: 3px solid rgba(255,255,255,0.4);
            animation: carPulse 2s ease-in-out infinite;
            position: relative;
        }
        .car-3d::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }
        .car-3d::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 12px;
            width: 12px;
            height: 12px;
            background: #6366f1;
            border-radius: 50%;
            box-shadow: 18px 0 0 0 #6366f1;
        }
        @keyframes carPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .pac-container { 
            background: rgba(30,41,59,0.98) !important; 
            color: white !important; 
            border: 1px solid rgba(255,255,255,0.2) !important;
            border-radius: 12px !important;
        }
        .status-glow { box-shadow: 0 0 20px rgba(16,185,129,0.5); }
    </style>
</head>
<body class="px-6 py-12 max-w-4xl mx-auto">
    
    <!-- GPS PERMISSION SCREEN -->
    <div id="gpsScreen" class="glass rounded-3xl p-12 text-center">
        <div class="mb-12">
            <div class="w-24 h-24 mx-auto bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center mb-8 shadow-2xl">
                <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"/>
                </svg>
            </div>
            <h1 class="text-4xl font-semibold gradient-text mb-4">Lane Ownership Pro</h1>
            <p class="text-xl text-white/80 mb-8 max-w-md mx-auto leading-relaxed">Enable GPS location to track your premium vehicle on Indian National Highways</p>
        </div>
        
        <div id="gpsStatus" class="p-8 rounded-2xl bg-white/5 mb-8 text-lg font-medium">
            <span class="inline-flex items-center gap-3">
                <span id="gpsIcon" class="text-2xl">üìç</span>
                <span id="gpsText">Turn on Location Services</span>
            </span>
        </div>
        
        <div class="space-y-4 mb-12 text-sm text-white/60">
            <p>‚Ä¢ Allow location access in browser settings</p>
            <p>‚Ä¢ Demo locations: Delhi | Mumbai | Bangalore</p>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
            <button onclick="enableGPS()" class="glass p-6 rounded-2xl hover:bg-white/10 transition-all font-medium flex items-center justify-center gap-3">
                <span class="text-xl">üîì</span>
                Enable GPS
            </button>
            <button onclick="useDelhiDemo()" class="glass p-6 rounded-2xl hover:bg-white/10 transition-all font-medium flex items-center justify-center gap-3">
                <span class="text-xl">üèõÔ∏è</span>
                Delhi
            </button>
            <button onclick="useMumbaiDemo()" class="glass p-6 rounded-2xl hover:bg-white/10 transition-all font-medium flex items-center justify-center gap-3">
                <span class="text-xl">üèôÔ∏è</span>
                Mumbai
            </button>
        </div>
    </div>

    <!-- MAIN DASHBOARD (Hidden Initially) -->
    <div id="mainDashboard" class="hidden">
        <!-- HEADER -->
        <div class="glass rounded-3xl p-8 mb-8 flex items-center justify-between">
            <div class="flex items-center gap-6">
                <div class="w-16 h-16 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center shadow-xl">
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl font-semibold gradient-text">Lane Ownership Pro</h1>
                    <p class="text-lg text-white/70" id="vehicleInfo">-</p>
                </div>
            </div>
            <div class="flex items-center gap-4 text-sm">
                <div class="glass px-4 py-2 rounded-xl">
                    <span class="font-semibold text-emerald-400" id="liveVehicles">24,847</span>
                    <span class="text-white/60">vehicles</span>
                </div>
                <button onclick="refreshLocation()" class="glass px-6 py-2 rounded-xl hover:bg-white/10 transition-all font-medium">Refresh GPS</button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- LIVE TRACKING MAP -->
            <div class="glass rounded-3xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-semibold gradient-text">Live GPS Tracking</h2>
                    <div class="flex items-center gap-4 text-sm">
                        <span class="px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded-full text-xs font-medium">Fast Lane</span>
                        <span class="px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-xs font-medium" id="trafficStatus">Light</span>
                    </div>
                </div>
                <div id="trackingMap"></div>
            </div>

            <!-- CONTROLS & STATS -->
            <div class="space-y-6">
                <!-- DESTINATION INPUT -->
                <div class="glass rounded-3xl p-6">
                    <h3 class="text-xl font-semibold gradient-text mb-4">Route to Destination</h3>
                    <input id="destinationInput" type="text" placeholder="Enter destination (Mumbai, Delhi, etc.)" 
                           class="w-full p-4 bg-black/40 border border-white/20 rounded-2xl text-lg font-medium pac-target-input focus:ring-2 focus:ring-emerald-400">
                    <button onclick="planRouteToDestination()" 
                            class="w-full mt-4 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-semibold py-4 px-6 rounded-2xl shadow-xl hover:shadow-2xl transition-all">
                        Plan Route
                    </button>
                </div>

                <!-- VEHICLE & STATS -->
                <div class="glass rounded-3xl p-6 space-y-4">
                    <h3 class="text-xl font-semibold gradient-text">Vehicle Status</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-white/70">Registration</span>
                            <span class="font-semibold text-white" id="currentReg">-</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-white/70">Owner</span>
                            <span class="font-semibold text-white" id="currentOwner">-</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-white/70">GPS Status</span>
                            <span class="font-semibold text-emerald-400 flex items-center gap-2" id="gpsStatus">
                                <span class="w-3 h-3 bg-emerald-400 rounded-full animate-pulse"></span>
                                Tracking
                            </span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-white/70">Speed</span>
                            <span class="font-semibold text-blue-400" id="currentSpeed">78 km/h</span>
                        </div>
                    </div>
                </div>

                <!-- LANE SELECTION -->
                <div class="glass rounded-3xl p-6">
                    <h3 class="text-xl font-semibold gradient-text mb-4">Lane Selection</h3>
                    <select class="w-full p-3 bg-black/40 border border-white/20 rounded-xl text-lg font-medium">
                        <option selected>üöÄ Premium Fast Lane (Recommended)</option>
                        <option>‚ö° Express Lane</option>
                        <option>üöó Normal Lane</option>
                    </select>
                    <button onclick="bookLane()" 
                            class="w-full mt-4 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-semibold py-4 px-6 rounded-2xl shadow-xl hover:shadow-2xl transition-all">
                        Book Selected Lane
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let map, userMarker, currentVehicleData = null;
        let trackingInterval;
        let userLat = 28.6139, userLng = 77.2090; // Default Delhi

        // RTO DATABASE
        const rtoDatabase = {
            'MH04AB1234': { owner: 'Rahul Sharma', model: 'Maruti Swift ZXi', color: '#10b981' },
            'DL8CA5678': { owner: 'Priya Singh', model: 'Hyundai Creta SX', color: '#3b82f6' },
            'KA01EF9012': { owner: 'Amit Patel', model: 'Tata Nexon XZ+', color: '#f59e0b' }
        };

        // Initialize Premium Map
        function initMap() {
            map = L.map('trackingMap').setView([userLat, userLng], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap ¬∑ Lane Ownership Pro'
            }).addTo(map);

            // 3D Vehicle Marker
            userMarker = L.marker([userLat, userLng], {
                icon: L.divIcon({
                    className: 'car-3d',
                    iconSize: [60, 60],
                    iconAnchor: [30, 30],
                    html: ''
                })
            }).addTo(map);

            map.setZoom(16);
        }

        // GPS PERMISSION & TRACKING [web:340]
        function enableGPS() {
            document.getElementById('gpsIcon').textContent = '‚è≥';
            document.getElementById('gpsText').textContent = 'Requesting location access...';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        userLat = position.coords.latitude;
                        userLng = position.coords.longitude;
                        
                        document.getElementById('gpsIcon').textContent = '‚úÖ';
                        document.getElementById('gpsText').innerHTML = 'GPS Active<br><span class="text-sm text-emerald-400">Live tracking enabled</span>';
                        document.getElementById('gpsStatus').classList.add('status-glow');
                        
                        showDashboard();
                        startTracking();
                    },
                    () => {
                        document.getElementById('gpsIcon').textContent = '‚ö†Ô∏è';
                        document.getElementById('gpsText').textContent = 'GPS permission denied';
                    },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 30000 }
                );
            } else {
                alert('GPS not supported by this browser');
            }
        }

        // Demo Locations
        function useDelhiDemo() {
            userLat = 28.6139; userLng = 77.2090;
            document.getElementById('gpsIcon').textContent = '‚úÖ';
            document.getElementById('gpsText').textContent = 'Delhi (Demo Mode)';
            showDashboard();
            simulateTracking();
        }

        function useMumbaiDemo() {
            userLat = 19.0760; userLng = 72.8774;
            document.getElementById('gpsIcon').textContent = '‚úÖ';
            document.getElementById('gpsText').textContent = 'Mumbai (Demo Mode)';
            showDashboard();
            simulateTracking();
        }

        // Show Main Dashboard
        function showDashboard() {
            document.getElementById('gpsScreen').style.display = 'none';
            document.getElementById('mainDashboard').classList.remove('hidden');
            initMap();
        }

        // Real-time GPS Tracking
        function startTracking() {
            trackingInterval = setInterval(() => {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        userLat = position.coords.latitude;
                        userLng = position.coords.longitude;
                        updateVehiclePosition();
                    },
                    null,
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 1000 }
                );
            }, 3000);
        }

        // Simulate Movement (Demo)
        function simulateTracking() {
            let angle = 0;
            trackingInterval = setInterval(() => {
                angle += 0.001;
                userLat += Math.cos(angle) * 0.0001;
                userLng += Math.sin(angle) * 0.0001;
                updateVehiclePosition();
            }, 2000);
        }

        // Update 3D Vehicle Position
        function updateVehiclePosition() {
            if (userMarker) {
                userMarker.setLatLng([userLat, userLng]);
                map.panTo([userLat, userLng], { animate: true, duration: 1 });
            }
        }

        // Vehicle Authentication
        function verifyVehicle(regNum) {
            regNum = regNum.toUpperCase().trim();
            if (rtoDatabase[regNum]) {
                currentVehicleData = rtoDatabase[regNum];
                document.getElementById('vehicleInfo').textContent = `${currentVehicleData.model} ‚Ä¢ ${currentVehicleData.owner}`;
                document.getElementById('currentReg').textContent = regNum;
                document.getElementById('currentOwner').textContent = currentVehicleData.owner;
                
                // Update 3D car color
                const carElement = document.querySelector('.car-3d');
                if (carElement) {
                    carElement.style.background = `linear-gradient(45deg, ${currentVehicleData.color}, ${adjustBrightness(currentVehicleData.color, 20)})`;
                }
            }
        }

        function adjustBrightness(hex, percent) {
            const num = parseInt(hex.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        // Route Planning
        function planRouteToDestination() {
            const destination = document.getElementById('destinationInput').value;
            if (!destination) return alert('Please enter destination');
            
            // Clear previous route
            map.eachLayer(layer => {
                if (layer instanceof L.Polyline) map.removeLayer(layer);
            });

            // Dynamic route calculation
            const route = [
                [userLat, userLng],
                [userLat - 0.02, userLng + 0.03],
                [parseFloat(destination.includes('Mumbai') ? '19.0760' : '12.9716'), 
                 parseFloat(destination.includes('Mumbai') ? '72.8774' : '77.5946')]
            ];

            L.polyline(route, {
                color: '#10b981',
                weight: 8,
                opacity: 0.9
            }).addTo(map);

            map.fitBounds(L.latLngBounds(route));
        }

        function bookLane() {
            alert('‚úÖ Premium Fast Lane Booked!\nFollow the green route on map.');
            document.getElementById('trafficStatus').textContent = 'Premium Booked';
            document.getElementById('trafficStatus').className = 'px-3 py-1 bg-emerald-500/30 text-emerald-400 rounded-full text-xs font-medium';
        }

        function refreshLocation() {
            enableGPS();
        }

        // Live Stats
        setInterval(() => {
            document.getElementById('liveVehicles').textContent = (24000 + Math.floor(Math.random() * 5000)).toLocaleString();
            document.getElementById('currentSpeed').textContent = (60 + Math.floor(Math.random() * 60)).toString() + ' km/h';
        }, 3000);

        // Google Places Autocomplete
        new google.maps.places.Autocomplete(
            document.getElementById('destinationInput'), {
                types: ['(cities)'],
                componentRestrictions: {country: 'in'}
            }
        );
    </script>
</body>
</html>
