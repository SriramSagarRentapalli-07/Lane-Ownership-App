<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lane Ownership Pro - FIXED Model Selection + 3D GPS</title>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBEbLeeT2G2czmJ5JMTckUj6qZJ3oqXg7k&libraries=places"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        *{font-family:'Inter',sans-serif;}
        .hud-font{font-family:'Orbitron',monospace;}
        
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%),
                        url('https://images.unsplash.com/photo-1588137488142-b52cc277f4f3?ixlib=rb-4.0.3&auto=format&fit=crop&w=3000&q=85') center/cover fixed;
            min-height: 100vh;
            color: white;
        }
        
        .glass{backdrop-filter:blur(30px);background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);box-shadow:0 25px 50px rgba(0,0,0,0.5);}
        .gradient-text{background:linear-gradient(135deg,#10B981 0%,#34D399 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
        #map{height:500px;border-radius:20px;box-shadow:0 25px 50px rgba(0,0,0,0.6);}
        
        /* 3D VEHICLES */
        .car-3d{width:55px;height:28px;background:linear-gradient(45deg,#10B981,#34D399);border-radius:28px 28px 10px 10px;position:relative;box-shadow:0 10px 30px rgba(16,185,129,0.6);border:2px solid rgba(255,255,255,0.6);}
        .car-3d::before{content:'';position:absolute;top:8px;left:15px;width:14px;height:14px;background:rgba(255,255,255,0.9);border-radius:50%;box-shadow:inset 0 2px 3px rgba(0,0,0,0.3);}
        .car-3d::after{content:'';position:absolute;bottom:2px;left:10px;width:12px;height:12px;background:#6366F1;border-radius:50%;box-shadow:30px 0 0 0 #6366F1;}
        
        /* BRAND COLORS */
        .maruti{background:linear-gradient(45deg,#10B981,#059669);}
        .tata{background:linear-gradient(45deg,#F59E0B,#D97706);}
        .hyundai{background:linear-gradient(45deg,#3B82F6,#1D4ED8);}
        .mahindra{background:linear-gradient(45deg,#EF4444,#DC2626);}
        .toyota{background:linear-gradient(45deg,#FBBF24,#F59E0B);}
        .honda{background:linear-gradient(45deg,#8B5CF6,#7C3AED);}
        .kia{background:linear-gradient(45deg,#EC4899,#DB2777);}
        .mg{background:linear-gradient(45deg,#06B6D4,#0891B2);}
        .citroen{background:linear-gradient(45deg,#84CC16,#65A30D);}
        .skoda{background:linear-gradient(45deg,#6366F1,#4F46E5);}
        
        /* FIXED SELECT STYLING */
        select {
            color: #ffffff !important;
            background: rgba(0,0,0,0.4) !important;
            border: 2px solid rgba(255,255,255,0.2) !important;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px !important;
        }
        select option {
            color: #000000 !important;
            background: #ffffff !important;
        }
        select:focus {
            outline: none !important;
            border-color: #10B981 !important;
            box-shadow: 0 0 0 3px rgba(16,185,129,0.3) !important;
        }
        
        .fade-in{animation:fadeIn 0.8s ease-out;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
    </style>
</head>
<body class="p-6 pt-20">
    
  <!-- FIXED VEHICLE + GPS LOGIN -->
  <div id="loginScreen" class="fixed inset-0 flex items-center justify-center z-50 bg-black/70 backdrop-blur-sm fade-in">
    <div class="glass rounded-3xl p-12 w-full max-w-lg mx-6 shadow-2xl max-h-[90vh] overflow-y-auto">
      <div class="text-center mb-8">
        <h1 class="text-4xl font-black gradient-text mb-4 hud-font">Vehicle Login</h1>
        <p class="text-white/70 text-lg">Complete vehicle details + GPS</p>
      </div>
      
      <!-- GPS LOCATION -->
      <div class="mb-8">
        <label class="block text-lg font-semibold text-white/90 mb-4">üìç Location Setup</label>
        <div id="gpsStatus" class="p-6 rounded-2xl bg-white/10 text-center mb-6">
          <div class="text-3xl mb-2" id="gpsIcon">üìç</div>
          <div class="text-lg font-semibold" id="gpsText">Turn on Location</div>
          <div class="text-sm text-white/60 mt-2" id="gpsCoords">-</div>
        </div>
        <div class="grid grid-cols-2 lg:grid-cols-3 gap-3">
          <button onclick="enableGPS()" class="glass p-4 rounded-2xl hover:bg-white/20 transition-all font-semibold flex flex-col items-center text-sm">
            <span class="text-2xl">üîì</span> Real GPS
          </button>
          <button onclick="useDelhiDemo()" class="glass p-4 rounded-2xl hover:bg-white/20 transition-all font-semibold flex flex-col items-center text-sm">
            <span class="text-xl">üèõÔ∏è</span> Delhi
          </button>
          <button onclick="useMumbaiDemo()" class="glass p-4 rounded-2xl hover:bg-white/20 transition-all font-semibold flex flex-col items-center text-sm">
            <span class="text-xl">üèôÔ∏è</span> Mumbai
          </button>
        </div>
      </div>
      
      <!-- COMPLETE VEHICLE FORM -->
      <div class="space-y-4">
        <div>
          <label class="block text-lg font-semibold text-white/90 mb-3">üöô Registration No.</label>
          <input id="regNumber" type="text" placeholder="MH04AB1234" maxlength="13" class="w-full p-4 bg-white/10 border border-white/20 rounded-2xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-emerald-500 text-lg font-bold uppercase">
        </div>
        
        <!-- COMPANY -->
        <div>
          <label class="block text-lg font-semibold text-white/90 mb-3">üè¢ Company</label>
          <select id="company" onchange="loadVehicleTypes()" class="w-full p-4 text-lg font-bold">
            <option value="">Select Company</option>
            <optgroup label="üáÆüá≥ Indian Brands">
              <option value="maruti">Maruti Suzuki</option>
              <option value="tata">Tata Motors</option>
              <option value="mahindra">Mahindra</option>
            </optgroup>
            <optgroup label="üåç Global Brands">
              <option value="hyundai">Hyundai</option>
              <option value="toyota">Toyota</option>
              <option value="honda">Honda</option>
              <option value="kia">Kia</option>
              <option value="mg">MG Motor</option>
            </optgroup>
          </select>
        </div>
        
        <!-- VEHICLE TYPE -->
        <div>
          <label class="block text-lg font-semibold text-white/90 mb-3">üöó Vehicle Type</label>
          <select id="vehicleType" onchange="loadModels()" disabled class="w-full p-4 text-lg font-bold">
            <option value="">Select Type</option>
          </select>
        </div>
        
        <!-- MODEL - FIXED SELECTION -->
        <div>
          <label class="block text-lg font-semibold text-white/90 mb-3">üìã Model</label>
          <select id="vehicleModel" disabled class="w-full p-4 text-lg font-bold">
            <option value="">Select Model</option>
          </select>
        </div>
      </div>
      
      <button onclick="verifyVehicle()" class="w-full mt-8 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-black py-5 px-8 rounded-3xl shadow-2xl hover:shadow-3xl transform hover:-translate-y-2 transition-all duration-500 text-xl">
        üöÄ Start Navigation
      </button>
    </div>
  </div>

  <!-- MAIN DASHBOARD -->
  <div id="mainApp" class="hidden min-h-screen">
    <!-- Header -->
    <div class="glass rounded-3xl p-6 mb-8 shadow-2xl flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 max-w-6xl mx-auto">
      <div class="flex items-center">
        <div class="w-16 h-16 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center mr-4 shadow-2xl" id="vehiclePreview">
          <div class="car-3d maruti" style="width:50px;height:25px;"></div>
        </div>
        <div>
          <h1 class="text-3xl lg:text-4xl font-black gradient-text hud-font">Lane Ownership Pro</h1>
          <p class="text-lg text-white/80" id="vehicleInfo">-</p>
        </div>
      </div>
      <div class="flex gap-4">
        <div class="text-right bg-white/10 p-4 rounded-2xl">
          <div class="text-2xl font-black text-emerald-400" id="liveVehicles">24,847</div>
          <div class="text-sm text-white/60">Live Vehicles</div>
        </div>
        <button onclick="logout()" class="glass px-6 py-3 rounded-xl text-sm font-semibold hover:bg-white/20 transition-all">Logout</button>
      </div>
    </div>

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8 px-6">
      <!-- LIVE TRACKING MAP -->
      <div class="glass rounded-3xl p-8 shadow-2xl">
        <h2 class="text-2xl font-bold mb-6 flex items-center gradient-text">üõ∞Ô∏è Live 3D Vehicle Tracking</h2>
        <div id="map"></div>
        <div class="flex gap-3 mt-4 text-sm">
          <button onclick="centerVehicle()" class="flex-1 p-3 bg-white/20 hover:bg-white/30 rounded-xl transition-all font-medium">üìç Track My Vehicle</button>
          <button onclick="clearRoutes()" class="flex-1 p-3 bg-white/20 hover:bg-white/30 rounded-xl transition-all font-medium">üóëÔ∏è Clear Route</button>
        </div>
      </div>

      <!-- ROUTE PLANNER -->
      <div class="glass rounded-3xl p-8 shadow-2xl">
        <h2 class="text-2xl font-bold mb-8 flex items-center gradient-text">üß≠ Route Planner</h2>
        <div class="space-y-6">
          <div>
            <label class="block text-sm font-semibold text-white/90 mb-3">üìç Starting Location</label>
            <div class="p-6 bg-black/40 border border-white/20 rounded-2xl text-center text-xl font-bold text-emerald-400" id="startLocation">GPS Active</div>
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-white/90 mb-3">üéØ Destination City</label>
            <input id="destinationInput" type="text" placeholder="Mumbai, Delhi, Bangalore..." class="w-full p-5 bg-black/30 border-2 border-white/30 rounded-2xl text-lg font-bold text-white pac-target-input focus:ring-4 focus:ring-emerald-500/50">
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div class="p-5 bg-black/40 border border-white/20 rounded-2xl text-center">
              <div class="text-2xl font-black text-emerald-400" id="distanceDisplay">-</div>
              <div class="text-xs text-white/70">Distance</div>
            </div>
            <div class="p-5 bg-black/40 border border-white/20 rounded-2xl text-center">
              <div class="text-2xl font-black text-blue-400" id="timeDisplay">-</div>
              <div class="text-xs text-white/70">ETA</div>
            </div>
          </div>
          
          <button onclick="calculateRoute()" class="w-full bg-gradient-to-r from-emerald-500 via-green-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-black py-6 px-8 rounded-3xl shadow-2xl hover:shadow-3xl transform hover:-translate-y-2 transition-all text-xl">
            üß† Calculate Premium Route
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // GLOBAL STATE
    let map, userVehicleMarker, currentRoute, userLocation = {lat: 28.6139, lng: 77.2090};
    let gpsActive = false, vehicleData = null;
    
    // COMPLETE INDIAN VEHICLE DATABASE - FIXED
    const indianVehicles = {
      maruti: {
        name: "Maruti Suzuki",
        types: {
          hatchback: ["Swift", "Baleno", "WagonR", "Alto K10", "Celerio", "Ignis", "S-Presso"],
          sedan: ["Dzire", "Ciaz"],
          suv: ["Brezza", "Grand Vitara", "Fronx", "XL6"],
          mpv: ["Ertiga", "Invicto"]
        }
      },
      tata: {
        name: "Tata Motors",
        types: {
          hatchback: ["Punch", "Tiago", "Altroz"],
          sedan: ["Tigor"],
          suv: ["Nexon", "Harrier", "Safari", "Curvv"],
          ev: ["Nexon EV", "Tiago EV"]
        }
      },
      mahindra: {
        name: "Mahindra",
        types: {
          suv: ["XUV700", "Scorpio N", "Thar", "XUV3XO"],
          mpv: ["Bolero", "Bolero Neo", "Marazzo"]
        }
      },
      hyundai: {
        name: "Hyundai",
        types: {
          hatchback: ["i20", "Grand i10 Nios"],
          sedan: ["Aura"],
          suv: ["Creta", "Venue", "Alcazar"]
        }
      },
      toyota: {
        name: "Toyota",
        types: {
          hatchback: ["Glanza"],
          suv: ["Fortuner", "Innova Crysta", "Hyryder"]
        }
      },
      honda: {
        name: "Honda",
        types: {
          sedan: ["Amaze", "City"],
          suv: ["Elevate"]
        }
      },
      kia: {
        name: "Kia",
        types: {
          suv: ["Seltos", "Sonet", "Carens"]
        }
      },
      mg: {
        name: "MG Motor",
        types: {
          suv: ["Hector", "Astor", "Gloster"]
        }
      }
    };

    // FIXED MODEL SELECTION - STEP BY STEP
    function loadVehicleTypes() {
      const company = document.getElementById('company').value;
      const typeSelect = document.getElementById('vehicleType');
      const modelSelect = document.getElementById('vehicleModel');
      
      // Reset lower selects
      typeSelect.innerHTML = '<option value="">Select Type</option>';
      modelSelect.innerHTML = '<option value="">Select Model</option>';
      typeSelect.disabled = !company;
      modelSelect.disabled = true;
      
      // Load types for selected company
      if (company && indianVehicles[company]) {
        Object.keys(indianVehicles[company].types).forEach(typeKey => {
          const typeName = typeKey.charAt(0).toUpperCase() + typeKey.slice(1);
          typeSelect.innerHTML += `<option value="${typeKey}">${typeName}</option>`;
        });
      }
    }

    function loadModels() {
      const company = document.getElementById('company').value;
      const vehicleType = document.getElementById('vehicleType').value;
      const modelSelect = document.getElementById('vehicleModel');
      
      // Reset models
      modelSelect.innerHTML = '<option value="">Select Model</option>';
      modelSelect.disabled = !vehicleType || !company;
      
      // Load models for selected company + type
      if (company && vehicleType && indianVehicles[company] && indianVehicles[company].types[vehicleType]) {
        indianVehicles[company].types[vehicleType].forEach(model => {
          modelSelect.innerHTML += `<option value="${model}">${model}</option>`;
        });
      }
    }

    // GPS FUNCTIONS
    function enableGPS() {
      document.getElementById('gpsIcon').textContent = '‚è≥';
      document.getElementById('gpsText').textContent = 'Locating...';
      
      navigator.geolocation.getCurrentPosition(
        position => {
          userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          gpsActive = true;
          updateLocationDisplay();
          document.getElementById('gpsIcon').textContent = '‚úÖ';
          document.getElementById('gpsText').textContent = 'GPS Active';
        },
        () => {
          document.getElementById('gpsIcon').textContent = '‚ö†Ô∏è';
          document.getElementById('gpsText').textContent = 'GPS Denied - Use Demo';
          useDelhiDemo();
        },
        {enableHighAccuracy: true, timeout: 10000, maximumAge: 30000}
      );
    }

    function useDelhiDemo() { userLocation = {lat: 28.6139, lng: 77.2090}; updateLocationDisplay(); document.getElementById('gpsText').textContent = 'Delhi Demo'; }
    function useMumbaiDemo() { userLocation = {lat: 19.0760, lng: 72.8774}; updateLocationDisplay(); document.getElementById('gpsText').textContent = 'Mumbai Demo'; }

    function updateLocationDisplay() {
      document.getElementById('gpsCoords').textContent = `${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)}`;
    }

    // FIXED VERIFICATION
    function verifyVehicle() {
      const regNum = document.getElementById('regNumber').value.trim();
      const company = document.getElementById('company').value;
      const vType = document.getElementById('vehicleType').value;
      const model = document.getElementById('vehicleModel').value;
      
      if (!regNum || !company || !vType || !model) {
        alert('Please fill ALL fields: Reg No ‚Üí Company ‚Üí Type ‚Üí Model');
        return;
      }
      
      if (!gpsActive) {
        alert('Please enable GPS first');
        return;
      }
      
      vehicleData = {
        regNum,
        company,
        type: vType,
        model,
        fullName: `${indianVehicles[company].name} ${model}`,
        cssClass: company
      };
      
      // Update preview
      document.getElementById('vehicleInfo').textContent = `${vehicleData.fullName} ‚Ä¢ ${regNum}`;
      document.getElementById('vehiclePreview').innerHTML = `<div class="car-3d ${vehicleData.cssClass}" style="width:50px;height:25px;"></div>`;
      
      // Show dashboard
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
      
      initMap();
      createVehicleMarker();
      updateLocationDisplay();
    }

    // MAP INITIALIZATION
    function initMap() {
      map = L.map('map').setView([userLocation.lat, userLocation.lng], 16);
      
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: '¬© Esri ¬∑ Maxar ¬∑ NHAI',
        maxZoom: 20
      }).addTo(map);
    }

    function createVehicleMarker() {
      userVehicleMarker = L.marker([userLocation.lat, userLocation.lng], {
        icon: L.divIcon({
          html: `<div class="car-3d ${vehicleData.cssClass} shadow-lg" style="width:55px;height:28px;"></div>`,
          iconSize: [55, 28],
          iconAnchor: [27, 28],
          className: ''
        })
      }).addTo(map).bindPopup(`<b>${vehicleData.fullName}</b><br>${vehicleData.regNum}`);
    }

    function calculateRoute() {
      const destination = document.getElementById('destinationInput').value;
      if (!destination || !vehicleData) {
        alert('Enter destination');
        return;
      }
      
      if (currentRoute) map.removeLayer(currentRoute);
      
      const destCoords = {
        'Mumbai': [19.0760, 72.8774],
        'Delhi': [28.6139, 77.2090],
        'Bangalore': [12.9716, 77.5946],
        'Kolkata': [22.5726, 88.3639],
        'Chennai': [13.0827, 80.2707]
      }[destination.split(',')[0]] || [19.0760, 72.8774];
      
      const routePoints = [
        [userLocation.lat, userLocation.lng],
        [userLocation.lat - 0.1, userLocation.lng + 0.05],
        destCoords
      ];
      
      currentRoute = L.polyline(routePoints, {
        color: getBrandColor(vehicleData.company),
        weight: 12,
        opacity: 0.9
      }).addTo(map);
      
      map.fitBounds(currentRoute.getBounds());
    }

    function getBrandColor(company) {
      const colors = {
        maruti: '#10B981', tata: '#F59E0B', hyundai: '#3B82F6', 
        mahindra: '#EF4444', toyota: '#FBBF24', honda: '#8B5CF6',
        kia: '#EC4899', mg: '#06B6D4'
      };
      return colors[company] || '#10B981';
    }

    function centerVehicle() {
      map.setView(userVehicleMarker.getLatLng(), 18);
    }

    function clearRoutes() {
      if (currentRoute) {
        map.removeLayer(currentRoute);
        currentRoute = null;
      }
    }

    function logout() {
      document.getElementById('mainApp').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
    }

    // Live stats
    setInterval(() => {
      document.getElementById('liveVehicles').textContent = (24000 + Math.floor(Math.random() * 5000)).toLocaleString();
    }, 3000);
  </script>
</body>
</html>
