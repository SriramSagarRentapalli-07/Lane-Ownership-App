<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lane Ownership Pro - MODEL SELECTION FIXED</title>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        *{font-family:'Inter',sans-serif;}
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%),
                        url('https://images.unsplash.com/photo-1588137488142-b52cc277f4f3?ixlib=rb-4.0.3&auto=format&fit=crop&w=3000&q=85') center/cover fixed;
            min-height: 100vh;
            color: white;
        }
        .glass{backdrop-filter:blur(30px);background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);box-shadow:0 25px 50px rgba(0,0,0,0.5);}
        .gradient-text{background:linear-gradient(135deg,#10B981 0%,#34D399 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
        #map{height:500px;border-radius:20px;box-shadow:0 25px 50px rgba(0,0,0,0.6);}
        
        /* PERFECT SELECT STYLING - NO ISSUES */
        select {
            background: rgba(0,0,0,0.4) !important;
            border: 2px solid rgba(255,255,255,0.3) !important;
            color: white !important;
            padding: 16px !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            border-radius: 16px !important;
            width: 100% !important;
            min-height: 56px !important;
            cursor: pointer !important;
        }
        select option {
            background: white !important;
            color: black !important;
            padding: 12px !important;
            font-size: 16px !important;
        }
        select:focus {
            outline: none !important;
            border-color: #10B981 !important;
            box-shadow: 0 0 0 4px rgba(16,185,129,0.2) !important;
        }
        
        .car-3d{width:55px;height:28px;background:linear-gradient(45deg,#10B981,#34D399);border-radius:28px 28px 10px 10px;position:relative;box-shadow:0 10px 30px rgba(16,185,129,0.6);border:2px solid rgba(255,255,255,0.6);}
        .car-3d::before{content:'';position:absolute;top:8px;left:15px;width:14px;height:14px;background:rgba(255,255,255,0.9);border-radius:50%;box-shadow:inset 0 2px 3px rgba(0,0,0,0.3);}
        .car-3d::after{content:'';position:absolute;bottom:2px;left:10px;width:12px;height:12px;background:#6366F1;border-radius:50%;box-shadow:30px 0 0 0 #6366F1;}
        .maruti{background:linear-gradient(45deg,#10B981,#059669);}
        .tata{background:linear-gradient(45deg,#F59E0B,#D97706);}
        .hyundai{background:linear-gradient(45deg,#3B82F6,#1D4ED8);}
    </style>
</head>
<body class="p-8">
    
  <!-- PERFECTLY WORKING VEHICLE LOGIN -->
  <div id="loginScreen" class="glass rounded-3xl p-12 max-w-2xl mx-auto shadow-2xl max-h-[90vh] overflow-y-auto">
    <div class="text-center mb-12">
      <h1 class="text-5xl font-black gradient-text mb-4">Vehicle Login</h1>
      <p class="text-xl text-white/80">Select your exact vehicle ‚Üí Enable GPS</p>
    </div>
    
    <!-- GPS -->
    <div class="mb-12">
      <h3 class="text-2xl font-bold mb-6 text-white/90">üìç Location</h3>
      <div id="gpsStatus" class="p-8 rounded-3xl bg-white/10 text-center mb-8 border-2 border-white/20">
        <div class="text-4xl mb-4" id="gpsIcon">üìç</div>
        <div class="text-2xl font-bold" id="gpsText">Enable Location</div>
        <div class="text-lg text-white/70 mt-2" id="gpsCoords">-</div>
      </div>
      <div class="grid grid-cols-3 gap-4">
        <button onclick="enableGPS()" class="glass p-6 rounded-3xl hover:bg-white/20 transition-all font-bold text-lg">üîì Real GPS</button>
        <button onclick="useDelhi()" class="glass p-6 rounded-3xl hover:bg-white/20 transition-all font-bold text-lg">üèõÔ∏è Delhi</button>
        <button onclick="useMumbai()" class="glass p-6 rounded-3xl hover:bg-white/20 transition-all font-bold text-lg">üèôÔ∏è Mumbai</button>
      </div>
    </div>
    
    <!-- VEHICLE SELECTION - PERFECTLY FIXED -->
    <div class="space-y-6">
      <div>
        <label class="block text-xl font-bold text-white/90 mb-4">üöó Registration Number</label>
        <input id="regNum" type="text" placeholder="MH04AB1234" maxlength="13" class="w-full p-6 rounded-3xl bg-white/10 border-2 border-white/20 text-xl font-bold uppercase text-white focus:ring-4 focus:ring-emerald-500/50">
      </div>
      
      <!-- COMPANY - STEP 1 -->
      <div>
        <label class="block text-xl font-bold text-white/90 mb-4">üè≠ Company (Step 1)</label>
        <select id="companySelect" onchange="onCompanyChange()" class="select-field">
          <option value="">Choose Company...</option>
          <option value="maruti">üáÆüá≥ Maruti Suzuki</option>
          <option value="tata">üáÆüá≥ Tata Motors</option>
          <option value="hyundai">üá∞üá∑ Hyundai</option>
          <option value="mahindra">üáÆüá≥ Mahindra</option>
          <option value="toyota">üáØüáµ Toyota</option>
          <option value="honda">üáØüáµ Honda</option>
        </select>
      </div>
      
      <!-- TYPE - STEP 2 -->
      <div>
        <label class="block text-xl font-bold text-white/90 mb-4">üöô Vehicle Type (Step 2)</label>
        <select id="typeSelect" disabled class="select-field">
          <option value="">First select company</option>
        </select>
      </div>
      
      <!-- MODEL - STEP 3 -->
      <div>
        <label class="block text-xl font-bold text-white/90 mb-4">üìã Model (Step 3)</label>
        <select id="modelSelect" disabled class="select-field">
          <option value="">Select type first</option>
        </select>
      </div>
    </div>
    
    <button onclick="completeLogin()" class="w-full mt-12 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-black py-6 px-8 rounded-3xl shadow-2xl hover:shadow-3xl transform hover:-translate-y-2 transition-all text-2xl">
      üöÄ Start Navigation
    </button>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="hidden min-h-screen p-8">
    <div class="glass rounded-3xl p-8 mb-12 shadow-2xl max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center">
        <div id="vehicleIcon" class="w-20 h-20 bg-emerald-500 rounded-2xl flex items-center justify-center mr-6 shadow-2xl">
          <div class="car-3d maruti" style="width:45px;height:22px;"></div>
        </div>
        <div>
          <h1 class="text-4xl font-black gradient-text">Lane Ownership Pro</h1>
          <p class="text-xl text-white/80" id="vehicleDisplay">-</p>
        </div>
      </div>
      <button onclick="logout()" class="glass px-8 py-4 rounded-2xl text-lg font-bold hover:bg-white/20 transition-all">Logout</button>
    </div>

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
      <div class="glass rounded-3xl p-8 shadow-2xl">
        <h2 class="text-3xl font-bold mb-8 gradient-text">üõ∞Ô∏è Live Vehicle Tracking</h2>
        <div id="map"></div>
        <div class="flex gap-4 mt-6">
          <button onclick="centerVehicle()" class="flex-1 p-4 bg-white/20 hover:bg-white/30 rounded-2xl font-bold text-lg">üìç Track Vehicle</button>
          <button onclick="clearRoute()" class="flex-1 p-4 bg-white/20 hover:bg-white/30 rounded-2xl font-bold text-lg">üóëÔ∏è Clear Route</button>
        </div>
      </div>

      <div class="glass rounded-3xl p-8 shadow-2xl space-y-6">
        <h2 class="text-3xl font-bold mb-6 gradient-text">üß≠ Route Planner</h2>
        <div class="p-8 bg-black/40 border-2 border-white/20 rounded-3xl text-center text-2xl font-bold text-emerald-400 mb-8" id="currentLocation">GPS Active</div>
        <input id="destination" placeholder="Enter destination (Mumbai, Delhi...)" class="w-full p-6 rounded-3xl bg-black/40 border-2 border-white/20 text-xl font-bold text-white focus:ring-4 focus:ring-emerald-500/50">
        <div class="grid grid-cols-2 gap-6 text-center">
          <div class="p-6 bg-black/50 border border-white/20 rounded-3xl">
            <div class="text-3xl font-black text-emerald-400" id="distance">-</div>
            <div class="text-lg text-white/70 mt-2">Distance</div>
          </div>
          <div class="p-6 bg-black/50 border border-white/20 rounded-3xl">
            <div class="text-3xl font-black text-blue-400" id="eta">-</div>
            <div class="text-lg text-white/70 mt-2">ETA</div>
          </div>
        </div>
        <button onclick="planRoute()" class="w-full bg-gradient-to-r from-emerald-500 to-teal-600 text-white font-black py-6 px-8 rounded-3xl shadow-2xl hover:shadow-3xl transform hover:-translate-y-2 text-xl">üß† Calculate Route</button>
      </div>
    </div>
  </div>

  <script>
    // STATE
    let map, vehicleMarker, currentVehicle = null, userLat = 28.6139, userLng = 77.2090;
    
    // COMPLETE VEHICLE DATABASE
    const vehicles = {
      maruti: {
        name: "Maruti Suzuki",
        types: {
          hatchback: ["Swift", "Baleno", "WagonR", "Alto K10", "Celerio"],
          sedan: ["Dzire", "Ciaz"],
          suv: ["Brezza", "Grand Vitara", "Fronx"],
          mpv: ["Ertiga", "Invicto"]
        }
      },
      tata: {
        name: "Tata Motors",
        types: {
          hatchback: ["Punch", "Tiago", "Altroz"],
          suv: ["Nexon", "Safari", "Harrier"],
          ev: ["Nexon EV", "Tiago EV"]
        }
      },
      hyundai: {
        name: "Hyundai",
        types: {
          hatchback: ["i20", "Grand i10"],
          suv: ["Creta", "Venue", "Alcazar"],
          sedan: ["Aura"]
        }
      },
      mahindra: {
        name: "Mahindra",
        types: {
          suv: ["XUV700", "Thar", "Scorpio N"],
          mpv: ["Bolero", "Bolero Neo"]
        }
      },
      toyota: {
        name: "Toyota",
        types: {
          suv: ["Fortuner", "Innova", "Hyryder"],
          hatchback: ["Glanza"]
        }
      },
      honda: {
        name: "Honda",
        types: {
          sedan: ["City", "Amaze"],
          suv: ["Elevate"]
        }
      }
    };

    // PERFECTLY WORKING CHAINED SELECTS
    function onCompanyChange() {
      const company = document.getElementById('companySelect').value;
      const typeSelect = document.getElementById('typeSelect');
      const modelSelect = document.getElementById('modelSelect');
      
      // Reset dependent selects
      typeSelect.innerHTML = '<option value="">Select Type</option>';
      typeSelect.disabled = !company;
      modelSelect.innerHTML = '<option value="">Select Type First</option>';
      modelSelect.disabled = true;
      
      if (company && vehicles[company]) {
        // Populate types
        Object.keys(vehicles[company].types).forEach(type => {
          typeSelect.innerHTML += `<option value="${type}">${type.charAt(0).toUpperCase() + type.slice(1)}</option>`;
        });
      }
    }

    function onTypeChange() {
      const company = document.getElementById('companySelect').value;
      const type = document.getElementById('typeSelect').value;
      const modelSelect = document.getElementById('modelSelect');
      
      modelSelect.innerHTML = '<option value="">Loading Models...</option>';
      modelSelect.disabled = true;
      
      if (company && type && vehicles[company] && vehicles[company].types[type]) {
        setTimeout(() => {
          modelSelect.innerHTML = '<option value="">Select Model</option>';
          vehicles[company].types[type].forEach(model => {
            modelSelect.innerHTML += `<option value="${model}">${model}</option>`;
          });
          modelSelect.disabled = false;
        }, 100);
      }
    }

    // GPS
    function enableGPS() {
      document.getElementById('gpsIcon').textContent = '‚è≥';
      document.getElementById('gpsText').textContent = 'Getting location...';
      
      navigator.geolocation.getCurrentPosition(
        pos => {
          userLat = pos.coords.latitude;
          userLng = pos.coords.longitude;
          document.getElementById('gpsIcon').textContent = '‚úÖ';
          document.getElementById('gpsText').textContent = 'GPS Active';
          document.getElementById('gpsCoords').textContent = `${userLat.toFixed(4)}, ${userLng.toFixed(4)}`;
        },
        () => {
          document.getElementById('gpsIcon').textContent = '‚ö†Ô∏è';
          document.getElementById('gpsText').textContent = 'GPS Denied';
        }
      );
    }

    function useDelhi() { userLat=28.6139; userLng=77.2090; updateGPS(); }
    function useMumbai() { userLat=19.0760; userLng=72.8774; updateGPS(); }
    function updateGPS() {
      document.getElementById('gpsCoords').textContent = `${userLat.toFixed(4)}, ${userLng.toFixed(4)}`;
    }

    // LOGIN
    function completeLogin() {
      const reg = document.getElementById('regNum').value;
      const company = document.getElementById('companySelect').value;
      const type = document.getElementById('typeSelect').value;
      const model = document.getElementById('modelSelect').value;
      
      if (!reg || !company || !type || !model) {
        alert('FILL ALL: Reg ‚Üí Company ‚Üí Type ‚Üí Model');
        return;
      }
      
      currentVehicle = {
        reg, company, type, model,
        name: `${vehicles[company].name} ${model}`,
        colorClass: company
      };
      
      document.getElementById('vehicleDisplay').textContent = `${currentVehicle.name} ‚Ä¢ ${reg}`;
      document.getElementById('vehicleIcon').innerHTML = `<div class="car-3d ${company}" style="width:45px;height:22px;"></div>`;
      
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      
      initMap();
    }

    // MAP
    function initMap() {
      map = L.map('map').setView([userLat, userLng], 16);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
      
      vehicleMarker = L.marker([userLat, userLng], {
        icon: L.divIcon({
          html: `<div class="car-3d ${currentVehicle.colorClass}" style="width:55px;height:28px;"></div>`,
          iconSize: [55, 28],
          iconAnchor: [27, 28]
        })
      }).addTo(map);
    }

    function planRoute() {
      const dest = document.getElementById('destination').value;
      const route = L.polyline([
        [userLat, userLng],
        [19.0760, 72.8774]
      ], {color: '#10B981', weight: 8}).addTo(map);
      map.fitBounds(route.getBounds());
    }

    function centerVehicle() { map.setView(vehicleMarker.getLatLng(), 18); }
    function clearRoute() { map.eachLayer(l => l instanceof L.Polyline && map.removeLayer(l)); }
    function logout() { location.reload(); }
  </script>
</body>
</html>
