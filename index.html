<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Lane Ownership - Real India Navigation</title>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh; overflow-x: hidden;
        }
        .glass-card { 
            background: rgba(255,255,255,0.15); backdrop-filter: blur(25px); 
            border: 1px solid rgba(255,255,255,0.25); border-radius: 24px; 
            box-shadow: 0 25px 45px rgba(0,0,0,0.4); 
        }
        .screen { display: none; min-height: 100vh; padding: 20px; }
        .screen.active { display: block; }
        
        /* PERFECTLY VISIBLE SELECTS */
        .input-group { 
            position: relative; margin-bottom: 20px; 
            background: rgba(255,255,255,0.12); border-radius: 20px; padding: 4px;
        }
        .input-group input, .input-group select {
            width: 100%; padding: 20px 24px; background: rgba(30,41,59,0.9) !important;
            border: 2px solid rgba(255,255,255,0.3) !important; border-radius: 16px; 
            color: #ffffff !important; font-size: 16px; font-weight: 500; outline: none;
        }
        .input-group input::placeholder { color: rgba(255,255,255,0.6) !important; }
        .input-group select {
            color: #ffffff !important; 
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ffffff' viewBox='0 0 24 24'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 16px center; background-size: 18px;
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
        }
        .input-group select option { 
            background: #1e3a5f !important; color: #ffffff !important; font-weight: 500 !important;
        }
        
        .login-btn { 
            width: 100%; padding: 20px; background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: #ffffff !important; border: none; border-radius: 20px; 
            font-size: 18px; font-weight: 700; cursor: pointer; margin: 8px 0;
        }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(59,130,246,0.4); }
        
        .destination-container {
            position: relative; margin: 20px; background: rgba(255,255,255,0.12);
            border-radius: 20px; padding: 4px; z-index: 10;
        }
        #driverDestination {
            width: 100%; padding: 24px; background: rgba(30,41,59,0.9) !important;
            border: 2px solid rgba(255,255,255,0.3) !important; border-radius: 16px; 
            color: #ffffff !important; font-size: 18px; font-weight: 500;
        }
        
        .autocomplete-dropdown {
            position: absolute; top: 100%; left: 0; right: 0; 
            background: rgba(30,41,59,0.98); border-radius: 0 0 16px 16px;
            max-height: 300px; overflow-y: auto; z-index: 1000; display: none;
            border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        .autocomplete-item {
            padding: 18px 20px; cursor: pointer; color: white; border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 16px; transition: background 0.2s; display: flex; align-items: center;
        }
        .autocomplete-item:hover { background: rgba(255,255,255,0.15); }
        
        #map { height: 60vh; width: calc(100% - 40px); margin: 20px auto; border-radius: 24px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .gps-status { position: absolute; top: 20px; right: 20px; background: rgba(16,185,129,0.95); color: white; padding: 12px 16px; border-radius: 20px; font-weight: 600; z-index: 1000; font-size: 14px; }
        .gps-off { background: rgba(245,101,101,0.95) !important; }
        
        .nav-header { padding: 16px 24px; background: rgba(30,58,138,0.4); color: white; position: sticky; top: 0; z-index: 100; }
        .route-info { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background: rgba(16,185,129,0.3); color: white; margin: 16px; border-radius: 20px; }
        .lane-badge { background: linear-gradient(135deg, #f59e0b, #fbbf24); color: white; padding: 10px 20px; border-radius: 25px; font-weight: 700; }
        
        .gps-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .gps-modal-content { background: linear-gradient(135deg, rgba(30,58,138,0.98), rgba(59,130,246,0.98)); color: white; padding: 40px; border-radius: 24px; text-align: center; max-width: 380px; margin: 20px; }
        .gps-btn { width: 100%; padding: 16px; margin: 10px 0; border: none; border-radius: 16px; font-weight: 700; cursor: pointer; }
        .gps-allow { background: linear-gradient(135deg, #10b981, #34d399); color: white; }
        .gps-deny { background: rgba(255,255,255,0.2); color: white; }

        /* LANE COLORS */
        .permitted-lane { stroke: #3b82f6 !important; stroke-width: 14px !important; stroke-opacity: 0.9 !important; box-shadow: 0 0 15px rgba(59,130,246,0.8) !important; }
        .other-lanes { stroke: #6b7280 !important; stroke-width: 10px !important; stroke-opacity: 0.6 !important; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Role Selection -->
        <div id="roleScreen" class="screen active" style="padding-top: 100px;">
            <div class="glass-card" style="max-width: 420px; margin: 0 auto; padding: 60px 32px;">
                <h2 style="color: #ffffff; font-size: 32px; margin-bottom: 40px;"><i class="fas fa-road"></i> Dynamic Lane Ownership</h2>
                <button class="login-btn" onclick="showScreen('driverLoginScreen')">
                    <i class="fas fa-car"></i> Driver Navigation
                </button>
                <button class="login-btn" onclick="showScreen('officerScreen')" style="background: linear-gradient(135deg, #ef4444, #dc2626); margin-top: 16px;">
                    <i class="fas fa-user-shield"></i> Traffic Officer
                </button>
            </div>
        </div>

        <!-- DRIVER LOGIN -->
        <div id="driverLoginScreen" class="screen">
            <div style="padding-top: 60px;">
                <div class="glass-card" style="max-width: 420px; margin: 0 auto; padding: 40px;">
                    <h2 style="color: #ffffff;"><i class="fas fa-car"></i> Driver Login</h2>
                    <div class="input-group">
                        <input type="tel" id="driverPhone" placeholder="Phone (9845123456)" value="9845123456">
                    </div>
                    <div class="input-group">
                        <input type="text" id="driverVehicle" placeholder="AP16 AB 1234" value="AP16 AB 1234">
                    </div>
                    <div class="input-group">
                        <select id="driverCompany">
                            <option value="">üîß Select Company</option>
                            <option value="Maruti Suzuki">Maruti Suzuki</option>
                            <option value="Hyundai">Hyundai</option>
                            <option value="Tata">Tata</option>
                            <option value="Mahindra">Mahindra</option>
                            <option value="Toyota">Toyota</option>
                            <option value="Honda">Honda</option>
                            <option value="Kia">Kia</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <select id="driverModel">
                            <option value="">üöó Select Model</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <select id="driverVehicleType">
                            <option value="carpool">üë• Carpool (3+)</option>
                            <option value="office">üè¢ Office Shuttle</option>
                            <option value="school">üöå School Bus</option>
                            <option value="general">üöó General</option>
                        </select>
                    </div>
                    <button class="login-btn" onclick="driverLogin()">üöÄ Start Navigation</button>
                    <button class="login-btn" onclick="showScreen('roleScreen')" style="background: rgba(255,255,255,0.1);">‚Üê Back</button>
                </div>
            </div>
        </div>

        <!-- GPS Modal -->
        <div id="gpsModal" class="gps-modal" style="display: none;">
            <div class="gps-modal-content">
                <i class="fas fa-location-arrow" style="font-size: 64px; color: #10b981; margin-bottom: 20px;"></i>
                <h3>Enable GPS Location</h3>
                <p style="margin: 20px 0;">**BLUE = YOUR PERMITTED LANE** (Follow Blue Roads Only!)</p>
                <button class="gps-btn gps-allow" onclick="enableGPS()">‚úÖ Allow Location</button>
                <button class="gps-btn gps-deny" onclick="skipGPS()">‚è≠Ô∏è Skip & Continue</button>
            </div>
        </div>

        <!-- Driver Screen -->
        <div id="driverScreen" class="screen">
            <div class="nav-header glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div id="driverVehicleDisplay" style="font-weight: 700;">Loading...</div>
                    <div class="gps-status gps-off" id="gpsStatus">GPS OFF</div>
                </div>
            </div>

            <div class="route-info" id="routeSummary" style="display: none;">
                <div>
                    <div id="routeDistance" style="font-size: 24px; font-weight: 700;">-- km</div>
                    <div id="routeETA" style="font-size: 14px;">-- mins</div>
                </div>
                <div class="lane-badge" id="assignedLane">Loading...</div>
            </div>

            <div class="destination-container glass-card">
                <input type="text" id="driverDestination" placeholder="VVIT, Delhi, Guntur, Pedakakani, Vijayawada..." autocomplete="off">
                <div class="autocomplete-dropdown" id="driverAutocomplete"></div>
            </div>
            
            <button class="login-btn" onclick="planRoute()" style="margin: 0 20px 20px;">
                üõ£Ô∏è Show Permitted Lanes (BLUE = Yours)
            </button>
            <div id="map"></div>
        </div>

        <!-- Officer Screen -->
        <div id="officerScreen" class="screen" style="padding-top: 100px;">
            <div class="glass-card" style="max-width: 500px; margin: 0 auto; padding: 60px 40px; text-align: center;">
                <h2 style="color: #ffffff;"><i class="fas fa-user-sh
