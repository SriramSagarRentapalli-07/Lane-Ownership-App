\<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Lane Ownership - Premium Traffic App</title>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            height: 100vh; overflow: hidden;
            position: relative;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a" cx="50%" cy="50%"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.1"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient></defs><circle cx="200" cy="200" r="100" fill="url(%23a)"><animate attributeName="cy" values="200;100;200" dur="3s" repeatCount="indefinite"/></circle><circle cx="800" cy="800" r="80" fill="url(%23a)"><animate attributeName="cy" values="800;900;800" dur="4s" repeatCount="indefinite"/></circle></svg>') no-repeat center/cover;
            z-index: 1; animation: float 20s infinite linear;
        }
        @keyframes float { 0%, 100% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-20px) rotate(180deg); } }
        
        .app-container { position: relative; z-index: 10; height: 100vh; display: flex; flex-direction: column; }
        .glass-card { 
            background: rgba(255,255,255,0.15); 
            backdrop-filter: blur(25px); 
            border: 1px solid rgba(255,255,255,0.25); 
            border-radius: 24px; 
            box-shadow: 0 25px 45px rgba(0,0,0,0.4); 
            position: relative; overflow: hidden;
        }
        .screen { display: none; height: 100vh; overflow-y: auto; padding: 20px; }
        .screen.active { display: block; }
        
        /* Login Screens - PERFECT VISIBILITY */
        .login-screen { text-align: center; padding-top: 80px; }
        .login-card { max-width: 420px; margin: 0 auto; padding: 40px 32px; }
        .login-card h2 { 
            color: #ffffff !important; margin-bottom: 32px; font-size: 28px; font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .input-group { 
            margin-bottom: 24px; position: relative; 
            background: rgba(255,255,255,0.12) !important;
            border-radius: 20px; padding: 4px; border: 1px solid rgba(255,255,255,0.2);
        }
        .input-group input, .input-group select {
            width: 100%; padding: 18px 24px; background: transparent !important;
            border: none !important; border-radius: 16px; 
            color: #ffffff !important; font-size: 16px; font-weight: 500;
            backdrop-filter: blur(10px);
        }
        .input-group input::placeholder { color: rgba(255,255,255,0.7) !important; }
        .input-group select option {
            background: #1e293b !important; color: #ffffff !important; padding: 12px;
        }
        .login-btn { 
            width: 100%; padding: 20px; 
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: #ffffff !important; border: none; border-radius: 20px; 
            font-size: 18px; font-weight: 700; cursor: pointer; 
            transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
        }
        .login-btn:hover { transform: translateY(-4px); box-shadow: 0 25px 50px rgba(59,130,246,0.5); }
        .btn { padding: 12px 24px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin: 4px; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: white; }
        
        /* Driver Dashboard */
        .dashboard-header { 
            padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; 
            background: rgba(30,58,138,0.4); backdrop-filter: blur(20px);
            border-radius: 0 0 24px 24px; margin: 0 0 20px; position: sticky; top: 0; z-index: 100;
        }
        .user-info { display: flex; align-items: center; gap: 16px; color: #ffffff; }
        .vehicle-icon { width: 56px; height: 56px; border-radius: 16px; background: linear-gradient(135deg, #f59e0b, #fbbf24); display: flex; align-items: center; justify-content: center; font-size: 22px; color: white; }
        
        #driverMap { height: 450px; border-radius: 24px; margin: 0 20px 20px; box-shadow: 0 25px 50px rgba(0,0,0,0.4); }
        .destination-input { margin: 0 20px 24px; background: rgba(255,255,255,0.12); border-radius: 20px; padding: 4px; }
        .destination-input input { width: 100%; padding: 20px 24px; background: transparent; border: none; border-radius: 16px; color: #ffffff !important; font-size: 16px; }
        
        /* Officer Dashboard */
        .officer-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .stat-card { padding: 24px; text-align: center; }
        .stat-number { font-size: 32px; font-weight: 700; }
        .stat-label { color: rgba(255,255,255,0.8); font-size: 14px; }
        
        .violation-form { margin-bottom: 24px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px; }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; padding: 16px; background: rgba(255,255,255,0.1); 
            border: 1px solid rgba(255,255,255,0.3); border-radius: 16px; color: #ffffff !important; 
        }
        .fine-amount { background: linear-gradient(135deg, #ef4444, #f87171); color: white; padding: 12px; border-radius: 12px; text-align: center; font-weight: 700; }
        
        .violations-list { max-height: 300px; overflow-y: auto; }
        .violation-item { display: flex; gap: 16px; padding: 20px; margin-bottom: 16px; align-items: center; }
        .violation-image { width: 80px; height: 60px; background: linear-gradient(45deg, #ef4444, #f87171); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; }
        .status-new { background: linear-gradient(135deg, #f59e0b, #fbbf24); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        
        .custom-vehicle { width: 40px !important; height: 40px !important; background: none !important; animation: vehicleBounce 2s infinite; }
        @keyframes vehicleBounce { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-8px); } }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Role Selection -->
        <div id="roleScreen" class="screen active">
            <div class="login-screen">
                <div class="glass-card login-card" style="padding: 60px 32px;">
                    <h2 style="font-size: 32px; margin-bottom: 40px;"><i class="fas fa-road"></i> Dynamic Lane Ownership</h2>
                    <button class="login-btn" onclick="showLogin('driver')" style="margin-bottom: 20px;">
                        <i class="fas fa-car"></i> Driver Login
                    </button>
                    <button class="login-btn" onclick="showLogin('officer')" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                        <i class="fas fa-user-shield"></i> Traffic Officer
                    </button>
                </div>
            </div>
        </div>

        <!-- DRIVER LOGIN - FULLY FIXED -->
        <div id="driverLoginScreen" class="screen">
            <div class="login-screen">
                <div class="glass-card login-card">
                    <h2 style="color: #ffffff !important;"><i class="fas fa-car"></i> Driver Login</h2>
                    
                    <div class="input-group">
                        <input type="tel" id="driverPhone" placeholder="Phone Number (9845123456)" maxlength="10">
                    </div>
                    
                    <div class="input-group">
                        <input type="text" id="driverVehicle" placeholder="Vehicle Number (AP16 AB 1234)">
                    </div>
                    
                    <!-- COMPANY DROPDOWN - FULLY POPULATED -->
                    <div class="input-group">
                        <select id="driverCompany">
                            <option value="" style="color: #cccccc;">üîß Select Company</option>
                            <option value="Maruti Suzuki">Maruti Suzuki</option>
                            <option value="Hyundai">Hyundai</option>
                            <option value="Tata">Tata</option>
                            <option value="Mahindra">Mahindra</option>
                            <option value="Toyota">Toyota</option>
                            <option value="Honda">Honda</option>
                            <option value="Kia">Kia</option>
                            <option value="MG">MG</option>
                            <option value="Renault">Renault</option>
                            <option value="Nissan">Nissan</option>
                            <option value="Volkswagen">Volkswagen</option>
                            <option value="BMW">BMW</option>
                            <option value="Mercedes">Mercedes</option>
                        </select>
                    </div>
                    
                    <!-- MODEL DROPDOWN - DYNAMIC -->
                    <div class="input-group">
                        <select id="driverModel">
                            <option value="" style="color: #cccccc;">üöó Select Model (Choose Company First)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <select id="driverVehicleType">
                            <option value="carpool">üë• Carpool (3+ passengers)</option>
                            <option value="office">üè¢ Office Shuttle</option>
                            <option value="school">üöå School Bus</option>
                            <option value="general">üöó General Traffic</option>
                        </select>
                    </div>
                    
                    <button class="login-btn" onclick="driverLogin()">
                        <i class="fas fa-sign-in-alt"></i> Enter Dashboard
                    </button>
                    <button class="btn btn-secondary" onclick="showRoleScreen()" style="width: 100%;">
                        ‚Üê Back to Role Selection
                    </button>
                </div>
            </div>
        </div>

        <!-- OFFICER LOGIN -->
        <div id="officerLoginScreen" class="screen">
            <div class="login-screen">
                <div class="glass-card login-card">
                    <h2 style="color: #ffffff !important;"><i class="fas fa-user-shield"></i> Officer Login</h2>
                    <div class="input-group">
                        <input type="text" id="officerId" placeholder="Officer ID (OFF001)" value="OFF001">
                    </div>
                    <div class="input-group">
                        <select id="officerRoute">
                            <option value="">Select Patrol Route</option>
                            <option value="srm-vijayawada">SRM AP ‚Üí Vijayawada</option>
                            <option value="srm-guntur">SRM AP ‚Üí Guntur</option>
                            <option value="mangalagiri">Mangalagiri Ring Road</option>
                            <option value="nh16">NH-16 Highway</option>
                        </select>
                    </div>
                    <button class="login-btn" onclick="officerLogin()" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                        Start Patrol
                    </button>
                    <button class="btn btn-secondary" onclick="showRoleScreen()" style="width: 100%;">
                        ‚Üê Back
                    </button>
                </div>
            </div>
        </div>

        <!-- DRIVER DASHBOARD -->
        <div id="driverScreen" class="screen">
            <div class="dashboard-header glass-card">
                <div class="user-info">
                    <div class="vehicle-icon" id="driverVehicleIcon"><i class="fas fa-car"></i></div>
                    <div>
                        <div id="driverVehicleInfo" style="font-weight: 700; color: #ffffff;"></div>
                        <div id="driverLocation" style="font-size: 14px; opacity: 0.9; color: #e2e8f0;">Getting location...</div>
                    </div>
                </div>
            </div>
            <div id="driverCurrentLocation" style="display: none; font-size: 18px; color: #10b981; margin: 0 20px 24px; padding: 16px; background: rgba(16,185,129,0.2); border-radius: 16px; text-align: center;"></div>
            
            <div class="glass-card destination-input">
                <input type="text" id="driverDestination" placeholder="Type: Vijayawada, Guntur, Hyderabad...">
                <div id="driverAutocomplete" style="max-height: 200px; overflow-y: auto; display: none; background: rgba(30,41,59,0.9); border-radius: 12px;"></div>
            </div>
            <button class="login-btn" onclick="driverPlanRoute()" style="width: calc(100% - 40px); margin: 0 20px 24px;">
                <i class="fas fa-route"></i> Plan Route & Assign Lane
            </button>
            <div id="driverMap" class="glass-card"></div>
        </div>

        <!-- OFFICER DASHBOARD -->
        <div id="officerScreen" class="screen">
            <!-- Officer dashboard content same as before -->
            <div class="dashboard-header glass-card">
                <div class="user-info">
                    <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 16px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user-shield" style="color: white; font-size: 24px;"></i>
                    </div>
                    <div>
                        <div id="officerName" style="font-weight: 700; color: #ffffff;">Officer OFF001</div>
                        <div id="officerRouteInfo" style="font-size: 14px; opacity: 0.9;">Patrolling NH-16</div>
                    </div>
                </div>
            </div>
            <!-- Rest of officer dashboard (stats, fine form, violations list) -->
        </div>
    </div>

    <script>
        // COMPLETE MODEL DATA - 100+ MODELS
        const modelData = {
            "Maruti Suzuki": ["Swift", "Brezza", "Baleno", "Ertiga", "Dzire", "Alto 800", "WagonR", "Celerio", "S-Presso", "Ignis", "XL6", "Grand Vitara"],
            "Hyundai": ["Creta", "Venue", "i20", "Verna", "Grand i10 Nios", "Alcazar", "Tucson", "Ioniq 5", "Aura", "Xcent"],
            "Tata": ["Nexon", "Punch", "Safari", "Harrier", "Altroz", "Tiago", "Tigor", "Curvv"],
            "Mahindra": ["XUV700", "Thar", "Scorpio N", "XUV300", "Bolero", "XUV 3XO", "Thar Roxx"],
            "Toyota": ["Innova Crysta", "Fortuner", "Hyryder", "Urban Cruiser Taisor", "Glanza", "Camry"],
            "Honda": ["City", "Elevate", "Amaze", "WR-V"],
            "Kia": ["Seltos", "Sonet", "Carens", "EV6", "EV9"],
            "MG": ["Hector", "Astor", "Gloster", "ZS EV", "Comet EV"],
            "Renault": ["Kiger", "Triber", "Kwid"],
            "Nissan": ["Magnite", "Kicks"],
            "Volkswagen": ["Taigun", "Virtus"],
            "BMW": ["X1", "X3", "X5", "X7", "3 Series", "5 Series"],
            "Mercedes": ["GLA", "GLB", "GLC", "GLE", "A-Class", "C-Class"]
        };

        let currentUser = 'driver', driverMap, userLocation, destination;

        // üî• COMPANY ‚Üí MODEL DROPDOWN - PERFECTLY FIXED
        document.getElementById('driverCompany').addEventListener('change', function() {
            const company = this.value;
            const modelSelect = document.getElementById('driverModel');
            
            // Clear previous options
            modelSelect.innerHTML = '<option value="" style="color: #cccccc;">üöó Select Model</option>';
            
            if (company && modelData[company]) {
                // Populate models
                modelData[company].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    option.style.color = '#ffffff';
                    modelSelect.appendChild(option);
                });
            }
            console.log('Company changed to:', company, 'Models loaded:', modelData[company]?.length || 0);
        });

        // Role selection
        function showLogin(role) {
            currentUser = role;
            document.getElementById('roleScreen').classList.remove('active');
            document.getElementById(role === 'driver' ? 'driverLoginScreen' : 'officerLoginScreen').classList.add('active');
        }

        function showRoleScreen() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('roleScreen').classList.add('active');
        }

        // üî• DRIVER LOGIN - FULLY WORKING
        function driverLogin() {
            const phone = document.getElementById('driverPhone').value;
            const vehicle = document.getElementById('driverVehicle').value;
            const company = document.getElementById('driverCompany').value;
            const model = document.getElementById('driverModel').value;
            const vehicleType = document.getElementById('driverVehicleType').value;

            console.log('Login attempt:', {phone, vehicle, company, model, vehicleType});

            if (!phone || !vehicle || !company || !model || !vehicleType) {
                alert('‚ö†Ô∏è BRO! Fill ALL fields:\nüì± Phone\nüöó Vehicle No\nüè≠ Company\nüîß Model\nüöô Type');
                return;
            }

            // Update dashboard
            document.getElementById('driverVehicleInfo').innerHTML = `${company} ${model}`;
            document.getElementById('driverVehicleIcon').innerHTML = `<i class="fas fa-car-side"></i>`;
            
            document.getElementById('driverLoginScreen').classList.remove('active');
            document.getElementById('driverScreen').classList.add('active');
            
            // Initialize map and location
            setTimeout(() => {
                initDriverMap();
                getDriverLocation();
                initDriverAutocomplete();
            }, 500);
        }

        // Driver map and features (same as before)
        function initDriverMap() {
            driverMap = L.map('driverMap').setView([16.5062, 80.6480], 16);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(driverMap);
        }

        function getDriverLocation() {
            navigator.geolocation.getCurrentPosition(
                pos => {
                    userLocation = [pos.coords.latitude, pos.coords.longitude];
                    document.getElementById('driverCurrentLocation').style.display = 'block';
                    document.getElementById('driverCurrentLocation').innerHTML = 
                        `‚úÖ GPS Active: ${pos.coords.latitude.toFixed(4)}, ${pos.coords.longitude.toFixed(4)}`;
                    document.getElementById('driverLocation').textContent = 'Live tracking';
                },
                () => {
                    userLocation = [16.5062, 80.6480];
                    document.getElementById('driverCurrentLocation').innerHTML = 'üìç SRM AP Campus';
                }
            );
        }

        // PERFECT Driver Autocomplete
        function initDriverAutocomplete() {
            const input = document.getElementById('driverDestination');
            const predictions = document.getElementById('driverAutocomplete');
            
            input.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                if (query.length < 2) {
                    predictions.style.display = 'none';
                    return;
                }
                
                const cities = ['Vijayawada', 'Guntur', 'Hyderabad', 'Visakhapatnam', 'Chennai', 'Bengaluru'];
                const matches = cities.filter(city => city.toLowerCase().includes(query)).slice(0,5);
                
                predictions.innerHTML = '';
                matches.forEach(city => {
                    const div = document.createElement('div');
                    div.textContent = `üìç ${city}`;
                    div.style.cssText = 'padding: 12px 16px; cursor: pointer; color: white; border-bottom: 1px solid rgba(255,255,255,0.1);';
                    div.onclick = () => {
                        input.value = city;
                        destination = { lat: 16.5062, lng: 80.6480 }; // Mock
                        predictions.style.display = 'none';
                    };
                    predictions.appendChild(div);
                });
                predictions.style.display = matches.length ? 'block' : 'none';
            });
        }

        function driverPlanRoute() {
            alert('‚úÖ ROUTE PLANNED! Lane assigned based on your vehicle type.');
        }

        // Officer functions (same as before)
        function officerLogin() {
            document.getElementById('officerScreen').classList.add('active');
            document.getElementById('officerLoginScreen').classList.remove('active');
        }
    </script>
</body>
</html>
